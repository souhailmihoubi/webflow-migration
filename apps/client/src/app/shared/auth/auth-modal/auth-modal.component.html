<div class="fixed inset-0 z-[100] flex items-center justify-center p-4">
  <!-- Backdrop -->
  <div
    class="absolute inset-0 bg-black/60 backdrop-blur-sm"
    (click)="onClose()"
    (keydown.escape)="onClose()"
    tabindex="0"
  ></div>

  <!-- Modal Container -->
  <div
    class="relative bg-cream rounded-none shadow-2xl w-full max-w-md p-8 md:p-10 transform transition-all"
  >
    <!-- Close Button -->
    <button
      (click)="onClose()"
      class="absolute top-4 right-4 text-primary hover:text-accent transition-colors"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="w-6 h-6"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>

    <!-- Content -->
    <div class="text-center mb-8">
      <h2 class="text-3xl font-heading font-bold text-primary mb-2">
        {{
          currentView === 'login'
            ? 'Connexion'
            : currentView === 'register'
              ? 'Créer un Compte'
              : 'Mot de Passe Oublié'
        }}
      </h2>
      <div class="w-16 h-1 bg-accent mx-auto"></div>
    </div>

    <!-- Error Message -->
    @if (errorMessage()) {
      <div class="bg-red-50 border-l-4 border-red-500 p-4 mb-6">
        <p class="text-sm text-red-700">{{ errorMessage() }}</p>
      </div>
    }

    <!-- Login Form -->
    @if (currentView === 'login') {
      <form (ngSubmit)="onLogin()" class="space-y-6">
        <div>
          <label
            for="email"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            id="email"
            [(ngModel)]="loginData.email"
            name="email"
            required
            class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
            placeholder="votre@email.com"
          />
        </div>
        <div>
          <label
            for="password"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Mot de passe</label
          >
          <input
            type="password"
            id="password"
            [(ngModel)]="loginData.password"
            name="password"
            required
            class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
            placeholder="••••••••"
          />
        </div>

        <div class="flex justify-end">
          <button
            type="button"
            (click)="switchView('forgot-password')"
            class="text-sm text-gray-500 hover:text-accent transition-colors"
          >
            Mot de passe oublié ?
          </button>
        </div>

        <button
          type="submit"
          [disabled]="isLoading"
          class="w-full bg-primary text-white font-heading font-medium uppercase tracking-widest py-4 hover:bg-zinc-800 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ isLoading ? 'Connexion...' : 'Se Connecter' }}
        </button>

        <div class="text-center text-sm text-gray-500 mt-6">
          Pas encore de compte ?
          <button
            type="button"
            (click)="switchView('register')"
            class="text-accent font-medium hover:text-primary transition-colors"
          >
            Créer un compte
          </button>
        </div>
      </form>
    }

    <!-- Register Form -->
    @if (currentView === 'register') {
      <form (ngSubmit)="onRegister()" class="space-y-6">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label
              for="firstName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Prénom</label
            >
            <input
              type="text"
              id="firstName"
              [(ngModel)]="registerData.firstName"
              name="firstName"
              required
              class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
              placeholder="Jean"
            />
          </div>
          <div>
            <label
              for="lastName"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Nom</label
            >
            <input
              type="text"
              id="lastName"
              [(ngModel)]="registerData.lastName"
              name="lastName"
              required
              class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
              placeholder="Dupont"
            />
          </div>
        </div>
        <div>
          <label
            for="reg-email"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            id="reg-email"
            [(ngModel)]="registerData.email"
            name="email"
            required
            class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
            placeholder="votre@email.com"
          />
        </div>
        <div>
          <label
            for="reg-password"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Mot de passe</label
          >
          <input
            type="password"
            id="reg-password"
            [(ngModel)]="registerData.password"
            name="password"
            required
            class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
            placeholder="••••••••"
          />
        </div>

        <button
          type="submit"
          [disabled]="isLoading"
          class="w-full bg-primary text-white font-heading font-medium uppercase tracking-widest py-4 hover:bg-zinc-800 transition-colors duration-300 disabled:opacity-50 disabled:cursor-not-allowed"
        >
          {{ isLoading ? 'Inscription...' : "S'inscrire" }}
        </button>

        <div class="text-center text-sm text-gray-500 mt-6">
          Déjà un compte ?
          <button
            type="button"
            (click)="switchView('login')"
            class="text-accent font-medium hover:text-primary transition-colors"
          >
            Se connecter
          </button>
        </div>
      </form>
    }

    <!-- Forgot Password Form -->
    @if (currentView === 'forgot-password') {
      <form (ngSubmit)="onForgotPassword()" class="space-y-6">
        <p class="text-gray-600 text-sm text-center mb-4">
          Entrez votre adresse email et nous vous enverrons un lien pour
          réinitialiser votre mot de passe.
        </p>

        <div>
          <label
            for="fp-email"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Email</label
          >
          <input
            type="email"
            id="fp-email"
            class="w-full bg-white border border-gray-200 px-4 py-3 focus:outline-none focus:border-accent transition-colors text-primary font-sans"
            placeholder="votre@email.com"
          />
        </div>

        <button
          type="submit"
          class="w-full bg-primary text-white font-heading font-medium uppercase tracking-widest py-4 hover:bg-zinc-800 transition-colors duration-300"
        >
          Envoyer le lien
        </button>

        <div class="text-center text-sm text-gray-500 mt-6">
          <button
            type="button"
            (click)="switchView('login')"
            class="text-accent font-medium hover:text-primary transition-colors flex items-center justify-center w-full"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="w-4 h-4 mr-2"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18"
              />
            </svg>
            Retour à la connexion
          </button>
        </div>
      </form>
    }
  </div>
</div>
