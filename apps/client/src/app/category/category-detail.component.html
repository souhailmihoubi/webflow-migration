@if (isLoading()) {
  <div class="min-h-[60vh] flex items-center justify-center bg-cream-light">
    <div
      class="w-12 h-12 border-4 border-accent border-t-transparent rounded-full animate-spin"
    ></div>
  </div>
} @else if (category()) {
  <!-- Hero Section -->
  <section
    class="relative h-[60vh] flex items-center justify-center overflow-hidden"
  >
    <!-- Background Image with Overlay -->
    <div class="absolute inset-0">
      <img
        [src]="category()?.image || 'assets/images/placeholder-category.jpg'"
        [alt]="category()?.name"
        class="w-full h-full object-cover scale-110 active-zoom"
      />
      <div class="absolute inset-0 bg-black/40"></div>
    </div>

    <!-- Content -->
    <div class="relative z-10 text-center px-4">
      <nav class="flex justify-center mb-6" aria-label="Breadcrumb">
        <ol
          class="flex items-center space-x-2 text-[10px] md:text-xs uppercase tracking-[0.2em] font-bold"
        >
          <li>
            <a
              routerLink="/"
              class="text-white/70 hover:text-white transition-colors"
              >Accueil</a
            >
          </li>
          <li class="text-white/70">/</li>
          <li class="text-white">{{ category()?.name }}</li>
        </ol>
      </nav>
      <h1
        class="text-4xl md:text-6xl lg:text-7xl font-heading font-bold text-white uppercase tracking-wider mb-4"
      >
        {{ category()?.name }}
      </h1>
      <div class="w-24 h-1 bg-accent mx-auto"></div>
    </div>
  </section>

  <!-- Service Info Bar (Mini Ticker Style) -->
  <section class="bg-cream border-y border-accent/10 py-4">
    <div
      class="max-w-7xl mx-auto px-4 flex flex-wrap justify-center gap-8 md:gap-16"
    >
      <div class="flex items-center space-x-3 text-primary">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-5 h-5 text-accent"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M10.5 1.5H8.25A2.25 2.25 0 0 0 6 3.75v16.5a2.25 2.25 0 0 0 2.25 2.25h7.5A2.25 2.25 0 0 0 18 20.25V3.75a2.25 2.25 0 0 0-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"
          />
        </svg>
        <span class="text-xs font-bold uppercase tracking-widest"
          >+216 29 654 055</span
        >
      </div>
      <div class="flex items-center space-x-3 text-primary">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke-width="1.5"
          stroke="currentColor"
          class="w-5 h-5 text-accent"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M8.25 18.75a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h6m-9 0H3.375a1.125 1.125 0 0 1-1.125-1.125V14.25m17.25 4.5a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m3 0h1.125c.621 0 1.129-.504 1.129-1.125V11.25c0-4.446-3.726-8.033-8.129-7.853V4.25m0 0H12m0 0V3.375c0-.621-.504-1.125-1.125-1.125h-2.25c-.621 0-1.125.504-1.125 1.125V4.25m0 0h-.375m0 0A1.125 1.125 0 0 1 7.125 3h1.125a1.125 1.125 0 0 1 1.125 1.125v1.125"
          />
        </svg>
        <span class="text-xs font-bold uppercase tracking-widest"
          >Livraison sur toute la Tunisie</span
        >
      </div>
    </div>
  </section>

  <!-- Products Content -->
  <section class="bg-cream-light py-20 px-4">
    <div class="max-w-7xl mx-auto">
      <!-- Search/Filter Header -->
      <div class="text-center mb-16">
        <h2
          class="text-3xl md:text-4xl font-heading font-bold text-primary uppercase tracking-widest mb-8"
        >
          Recherche
        </h2>
        <div class="max-w-xl mx-auto relative">
          <input
            type="text"
            placeholder="Votre Article Préféré..."
            class="w-full bg-white border-none py-4 px-8 rounded-full shadow-sm text-primary placeholder-gray-300 focus:ring-2 focus:ring-accent/20 transition-all"
            (input)="onLocalSearch($event)"
          />
          <div class="absolute right-6 top-1/2 -translate-y-1/2 text-accent">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-5 h-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"
              />
            </svg>
          </div>
        </div>
      </div>

      <!-- Filters Section -->
      <div
        class="flex flex-col md:flex-row justify-center items-center gap-6 mb-12"
      >
        <!-- Price Filter (Wider) -->
        <div
          class="flex items-center gap-2 bg-white p-3 border border-gray-200 w-full md:w-auto"
        >
          <input
            #minInput
            type="number"
            placeholder="Min TND"
            [value]="minPrice() || ''"
            class="w-32 p-2 text-sm border border-gray-100 focus:border-accent outline-none"
          />
          <span class="text-gray-400">-</span>
          <input
            #maxInput
            type="number"
            placeholder="Max TND"
            [value]="maxPrice() || ''"
            class="w-32 p-2 text-sm border border-gray-100 focus:border-accent outline-none"
          />
          <button
            (click)="applyPriceFilter(minInput.value, maxInput.value)"
            class="bg-accent text-white px-6 py-2 text-sm font-bold uppercase hover:bg-primary transition-colors"
          >
            Filter
          </button>
          @if (minPrice() || maxPrice()) {
            <button
              (click)="resetPriceFilter()"
              class="bg-gray-500 text-white px-4 py-2 text-sm font-bold uppercase hover:bg-gray-700 transition-colors flex items-center gap-1"
              title="Reset price filter"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="2"
                stroke="currentColor"
                class="w-4 h-4"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M6 18L18 6M6 6l12 12"
                />
              </svg>
              Reset
            </button>
          }
        </div>

        <div
          class="text-xs text-gray-500 font-medium uppercase tracking-widest"
        >
          {{ filteredProducts().length }} Articles
        </div>
      </div>
      <!-- Products Grid -->
      @if (paginatedProducts().length > 0) {
        <div
          class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8 lg:gap-12"
        >
          @for (product of paginatedProducts(); track product.id) {
            <a [routerLink]="['/product', product.slug]" class="group block">
              <div
                class="relative aspect-square overflow-hidden bg-white shadow-lg mb-6"
              >
                <img
                  [src]="product.mainImage"
                  [alt]="product.name"
                  class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-700"
                />
                <!-- Badge for discount -->
                @if (product.discountPrice) {
                  <div
                    class="absolute top-4 right-4 bg-accent text-white text-[10px] font-bold uppercase tracking-widest py-1.5 px-3"
                  >
                    Promotion
                  </div>
                }
              </div>

              <div class="text-center space-y-1.5">
                <h3
                  class="text-lg font-heading font-bold text-primary uppercase tracking-wider group-hover:text-accent transition-colors"
                >
                  {{ product.name }}
                </h3>
                <div class="flex items-center justify-center space-x-2">
                  @if (product.discountPrice) {
                    <span class="text-gray-400 line-through text-xs"
                      >{{ product.price }} TND</span
                    >
                    <span class="text-accent font-bold text-base md:text-lg"
                      >{{ product.discountPrice }} TND</span
                    >
                  } @else {
                    <span class="text-primary font-bold text-base md:text-lg"
                      >{{ product.price }} TND</span
                    >
                  }
                </div>
              </div>
            </a>
          }
        </div>

        <!-- Pagination Controls -->
        @if (totalPages() > 1) {
          <div class="flex items-center justify-center space-x-2 mt-20">
            <button
              (click)="setPage(currentPage() - 1)"
              [disabled]="currentPage() === 1"
              class="p-4 border border-accent/20 text-primary hover:bg-accent hover:text-white disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-primary transition-all duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M15.75 19.5L8.25 12l7.5-7.5"
                />
              </svg>
            </button>

            @for (i of [].constructor(totalPages()); track $index) {
              <button
                (click)="setPage($index + 1)"
                [class.bg-primary]="currentPage() === $index + 1"
                [class.text-white]="currentPage() === $index + 1"
                [class.border-primary]="currentPage() === $index + 1"
                class="w-12 h-12 border border-accent/20 text-sm font-bold uppercase tracking-widest transition-all duration-300 hover:border-primary"
              >
                {{ $index + 1 }}
              </button>
            }

            <button
              (click)="setPage(currentPage() + 1)"
              [disabled]="currentPage() === totalPages()"
              class="p-4 border border-accent/20 text-primary hover:bg-accent hover:text-white disabled:opacity-30 disabled:hover:bg-transparent disabled:hover:text-primary transition-all duration-300"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
                class="w-5 h-5"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M8.25 4.5l7.5 7.5-7.5 7.5"
                />
              </svg>
            </button>
          </div>
        }
      } @else if (hasSearched() || category()?.products?.length) {
        <div class="text-center py-20">
          <p class="text-gray-400 italic">
            Aucun produit ne correspond à votre recherche dans cette catégorie.
          </p>
        </div>
      } @else {
        <div class="text-center py-20 bg-white shadow-inner rounded-2xl">
          <div class="text-accent/20 mb-4">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1"
              stroke="currentColor"
              class="w-20 h-20 mx-auto"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="m20.25 7.5-.625 10.632a2.25 2.25 0 0 1-2.247 2.118H6.622a2.25 2.25 0 0 1-2.247-2.118L3.75 7.5m6 4.125 2.25 2.25m0 0 2.25 2.25m-2.25-2.25-2.25 2.25m2.25-2.25 2.25-2.25M3.75 7.5l.625-10.632A2.25 2.25 0 0 1 6.622 3.75h10.756a2.25 2.25 0 0 1 2.247 2.118L20.25 7.5m-16.5 0h16.5"
              />
            </svg>
          </div>
          <h3
            class="text-xl font-heading font-bold text-primary uppercase tracking-widest"
          >
            Bientôt disponible
          </h3>
          <p class="text-gray-400 mt-2">
            D'autres produits arrivent très prochainement dans cette catégorie.
          </p>
        </div>
      }
    </div>
  </section>
}
